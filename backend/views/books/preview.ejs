<%- include('../partials/header') %>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <% if (messages && messages.error) { %>
                <div class="alert alert-danger"><%= messages.error %></div>
            <% } %>
            
            <div class="card">
                <div class="card-header">
                    <h3>ƒê·ªçc th·ª≠: <%= book.title %></h3>
                </div>
                <div class="card-body">
                    <!-- Book Info -->
                    <div class="row mb-4">
                        <div class="col-md-2">
                            <img src="<%= book.coverImage && book.coverImage.startsWith('http') ? book.coverImage : '/uploads/' + book.coverImage %>" alt="<%= book.title %>" class="img-fluid">
                        </div>
                        <div class="col-md-10">
                            <h4><%= book.title %></h4>
                            <p class="text-muted lead">T√°c gi·∫£: <%= book.author %></p>
                            <p><%= book.description %></p>
                            <div class="mb-3">
                                <strong>Gi√°: <%= book.price.toLocaleString() %>ƒë</strong>
                                <a href="/books/<%= book._id %>" class="btn btn-primary ms-3">Xem chi ti·∫øt & Mua s√°ch</a>
                            </div>
                            <div class="alert alert-info">
                                <strong>üìñ N·ªôi dung ƒë·ªçc th·ª≠:</strong> 
                                <% 
                                const summary = previewContent.getPreviewSummary();
                                %>
                                <%= summary.totalChapters %> ch∆∞∆°ng ƒë·∫ßu 
                                (T·ªïng c·ªông kho·∫£ng <%= summary.totalWords %> t·ª´)
                            </div>
                        </div>
                    </div>

                    <!-- Table of Contents -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header">
                                    <h5>M·ª•c l·ª•c</h5>
                                </div>
                                <div class="list-group list-group-flush">
                                    <% previewContent.chapters.forEach((chapter, index) => { %>
                                        <a href="#chapter-<%= chapter.chapterNumber %>" 
                                           class="list-group-item list-group-item-action">
                                            <strong>Ch∆∞∆°ng <%= chapter.chapterNumber %></strong><br>
                                            <small><%= chapter.title %></small><br>
                                            <small class="text-muted"><%= chapter.wordCount %> t·ª´</small>
                                        </a>
                                    <% }); %>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="col-md-9">
                            <% previewContent.chapters.forEach((chapter, index) => { %>
                                <div class="chapter-content mb-5" id="chapter-<%= chapter.chapterNumber %>">
                                    <h3 class="chapter-title">
                                        Ch∆∞∆°ng <%= chapter.chapterNumber %>: <%= chapter.title %>
                                    </h3>
                                    <div class="chapter-text">
                                        <%- chapter.content.replace(/\n/g, '<br>') %>
                                    </div>
                                    <% if (index < previewContent.chapters.length - 1) { %>
                                        <hr class="my-5">
                                    <% } %>
                                </div>
                            <% }); %>
                            
                            <!-- End of Preview -->
                            <div class="text-center py-5 bg-light rounded">
                                <h4>üìö H·∫øt n·ªôi dung ƒë·ªçc th·ª≠</h4>
                                <p class="lead">ƒê·ªÉ ƒë·ªçc ti·∫øp, vui l√≤ng mua s√°ch!</p>
                                <a href="/books/<%= book._id %>" class="btn btn-primary btn-lg">
                                    Mua s√°ch ngay - <%= book.price.toLocaleString() %>ƒë
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.chapter-content {
    line-height: 1.8;
}

.chapter-title {
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.chapter-text {
    text-align: justify;
    font-size: 1.1em;
    text-indent: 2em;
}

.chapter-text br {
    margin-bottom: 1em;
}

/* Smooth scrolling for navigation links */
html {
    scroll-behavior: smooth;
}

/* Sticky table of contents */
@media (min-width: 768px) {
    .col-md-3 .card {
        position: sticky;
        top: 20px;
    }
}
</style>

<%- include('../partials/footer') %>